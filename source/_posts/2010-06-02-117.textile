---
layout: post
title: '关于PHPWind中读写文件缓存的方法（个人理解）'
date: 2010-6-2
wordpress_id: 117
permalink: /blogs/117
comments: true
---
<div id="_mcePaste"><strong>原理：</strong></div>
<div>PHPWind中虽然说使用了对Memcached的支持，但大部分的缓存还是基于文件形式的，即将数据库查询获取后的一些数据记录到文件中，以后便从文件中去读取数据，而不是每次都从数据库读取，然后间隔一段时间再去从数据读取一次新数据，并写入之前的文件中（更新缓存文件）。而这些缓存文件中大部分都是以一维，二维数组……形式存放在一个个PHP文件中，然后在程序加载数据的地方去加载这些缓存文件。</div>
<div></div>
<div></div>
<div id="_mcePaste"><strong>操作方法：</strong></div>
<div id="_mcePaste">1.判断是否更新缓存文件</div>
<blockquote>
<div id="_mcePaste">#具体的缓存文件</div>
<div id="_mcePaste">$cachefile = H_P."data/defaultcache_$page.php";</div></blockquote>
<blockquote>
<div id="_mcePaste">#判断缓存文件是否需要更新</div>
<div id="_mcePaste">#timestamp：系统时间 pre_cache：缓存每几秒更新一次  pwFilemtime($cachefile) ：获取缓存文件生成时间</div>
<div id="_mcePaste">if ($timestamp - $pre_cache &gt;= pwFilemtime($cachefile))</div></blockquote>
<div id="_mcePaste">2.写入文件缓存</div>
<blockquote>
<div id="_mcePaste">#将变量tmp写进缓存文件</div>
<div id="_mcePaste">#pw_var_export()可将变量，数组以PHP语法写入这个cache字符变量中</div>
<div id="_mcePaste">$cache = "&lt;?php\r\n\$tmp=".pw_var_export($tmp).";\r\n?&gt;";</div></blockquote>
<blockquote>
<div id="_mcePaste">#将缓存文件写入</div>
<div id="_mcePaste">writeover($cachefile,$cache);</div></blockquote>
<div id="_mcePaste">3.加载文件缓存</div>
<blockquote>
<div id="_mcePaste">#加载缓存文件，以下方法都可以使用</div>
<div id="_mcePaste">readfile($cachefile);</div>
<div id="_mcePaste">include($cachefile);</div></blockquote>
